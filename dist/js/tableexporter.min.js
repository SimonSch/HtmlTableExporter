/*!
 * TableExporter.js v0.0.1
 * Copyright 2016 Travis Clarke
 * Licensed under the MIT license
 *
 * Edited by SimonSch
 */
!function(t,e){function n(t,e){return x.each(e,function(e,i){x.isPlainObject(i)?"object"===i.type?t=n(t,i.options):t+="<th>"+(i.columnName?i.columnName:i.fieldName)+"</th>":t+="<th>"+i+"</th>"}),t}function i(t,n,o){for(var r=0;r<o.length;++r){var a=o[r];if(n)if(a.type&&"object"===a.type)t=i(t,n[a.fieldName],a.options);else if(a.type&&"date"===a.type)if(n[a.fieldName]){var f=n[a.fieldName];t+=f!==e&&null!==f?"<td>"+new Date(f).toLocaleString("de")+"</td>":"<td></td>"}else t+="<td></td>";else{var l=a.fieldName?a.fieldName:a;if(n[l]){var f=n[l];t+=f!==e&&null!==f?"<td>"+f+"</td>":"<td></td>"}else t+="<td></td>"}else t+="<td></td>"}return t}function o(t,e,o){return o.length>0&&(t+="<tr>",t=n(t,o),t+="</tr>",x.each(e,function(e,n){t+="<tr>",t=i(t,n,o),t+="</tr>"})),t}function r(t,e){e&&(t+=1462);var n=Date.parse(t);return(n-new Date(Date.UTC(1899,11,30)))/864e5}function a(t,e){for(var n={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},o=0;o!=t.length;++o)for(var a=0;a!=t[o].length;++a){i.s.r>o&&(i.s.r=o),i.s.c>a&&(i.s.c=a),i.e.r<o&&(i.e.r=o),i.e.c<a&&(i.e.c=a);var f={v:t[o][a]};if(null!=f.v){var l=XLSX.utils.encode_cell({c:a,r:o});"number"==typeof f.v?f.t="n":"boolean"==typeof f.v?f.t="b":f.v instanceof Date?(f.t="n",f.z=XLSX.SSF._table[14],f.v=r(f.v)):f.t="s",n[l]=f}}return i.s.c<1e7&&(n["!ref"]=XLSX.utils.encode_range(i)),n}function f(){return this instanceof f?(this.SheetNames=[],void(this.Sheets={})):new f}function l(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i!=t.length;++i)n[i]=255&t.charCodeAt(i);return e}function s(t,e,n,i){if(".xlsx"===i){var o=new f,r=a(t);o.SheetNames.push(n),o.Sheets[n]=r;var s={bookType:"xlsx",bookSST:!1,type:"binary"},d=XLSX.write(o,s);t=l(d)}saveAs(new Blob([t],{type:e+";"+x.fn.tableExport.charset}),n+i)}var x=t.jQuery;x.fn.convertJsonToHtml=function(t,e){var n=x.parseJSON(t),i='<table border="1">';return e?(i=o(i,n,e),i+="</table>"):(x.each(n,function(t,e){i+="<tr>",x.each(e,function(t,e){i+="<td>"+t+"</td>",i+="<td>"+e+"</td>"}),i+="</tr>"}),i+="</table>")},x.fn.tableExport=function(t,e){var n=this,i=e?t:x.extend({},x.fn.tableExport.defaults,t),o=x.fn.tableExport.rowDel,r=i.ignoreRows instanceof Array?i.ignoreRows:[i.ignoreRows],a=i.ignoreCols instanceof Array?i.ignoreCols:[i.ignoreCols],f=i.ignoreCSS instanceof Array?i.ignoreCSS.join(", "):i.ignoreCSS;return n.each(function(){function t(t){var e=JSON.parse(t),n=e.data,i=e.fileName,o=e.mimeType,r=e.fileExtension;s(n,o,i,r)}var n=x(this);e&&n.find("caption:not(.head)").remove();var l=n.find("tbody").find("tr"),l=i.headings?l.add(n.find("thead>tr")):l,l=i.footers?l.add(n.find("tfoot>tr")):l,d=i.headings?n.find("thead>tr").length:0,p="id"===i.fileName?n.attr("id")?n.attr("id"):x.fn.tableExport.defaultFileName:i.fileName,c={xlsx:function(e,n){var i=l.map(function(t,e){if(!~r.indexOf(t-d)&&!x(e).is(f)){var n=x(e).find("th, td");return[n.map(function(t,e){if(!~a.indexOf(t)&&!x(e).is(f))return x(e).text()}).get()]}}).get(),o=JSON.stringify({data:i,fileName:n,mimeType:x.fn.tableExport.xlsx.mimeType,fileExtension:x.fn.tableExport.xlsx.fileExtension});t(o)},xls:function(e,n){var i=x.fn.tableExport.xls.separator,o=l.map(function(t,e){if(!~r.indexOf(t-d)&&!x(e).is(f)){var n=x(e).find("th, td");return n.map(function(t,e){if(!~a.indexOf(t)&&!x(e).is(f))return x(e).text()}).get().join(i)}}).get().join(e),s=JSON.stringify({data:o,fileName:n,mimeType:x.fn.tableExport.xls.mimeType,fileExtension:x.fn.tableExport.xls.fileExtension});t(s)},csv:function(e,n){var i=x.fn.tableExport.csv.separator,o=l.map(function(t,e){if(!~r.indexOf(t-d)&&!x(e).is(f)){var n=x(e).find("th, td");return n.map(function(t,e){if(!~a.indexOf(t)&&!x(e).is(f))return x(e).text()}).get().join(i)}}).get().join(e),s=JSON.stringify({data:o,fileName:n,mimeType:x.fn.tableExport.csv.mimeType,fileExtension:x.fn.tableExport.csv.fileExtension});t(s)},txt:function(e,n){var i=x.fn.tableExport.txt.separator,o=l.map(function(t,e){if(!~r.indexOf(t-d)&&!x(e).is(f)){var n=x(e).find("th, td");return n.map(function(t,e){if(!~a.indexOf(t)&&!x(e).is(f))return x(e).text()}).get().join(i)}}).get().join(e),s=JSON.stringify({data:o,fileName:n,mimeType:x.fn.tableExport.txt.mimeType,fileExtension:x.fn.tableExport.txt.fileExtension});t(s)}};i.formats.forEach(function(t){c[t](o,p)})}),x.fn.tableExport.update=function(t){n.tableExport(x.extend({},i,t),!0)},x.fn.tableExport.reset=function(t){n.tableExport(i,!0)},x.fn.tableExport.remove=function(t){n.each(function(){x(this).find("caption:not(.head)").remove()})},n},x.fn.tableExport.defaults={headings:!0,footers:!0,formats:["xls","csv","txt"],fileName:"id",ignoreRows:null,ignoreCols:null,ignoreCSS:".tableexport-ignore"},x.fn.tableExport.charset="charset=utf-8",x.fn.tableExport.xlsx={defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},x.fn.tableExport.xls={defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},x.fn.tableExport.csv={defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"application/csv",fileExtension:".csv"},x.fn.tableExport.txt={defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},x.fn.tableExport.defaultFileName="myDownload",x.fn.tableExport.rowDel="\r\n",x.fn.tableExport.entityMap={"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47"}}(window);