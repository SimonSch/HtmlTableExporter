/*!
 * TableExporter.js v0.0.1
 * Copyright 2016 Travis Clarke
 * Licensed under the MIT license
 *
 * Edited by SimonSch
 */
!function(t,e){function n(t,e){return x.each(e,function(e,o){x.isPlainObject(o)?"object"===o.type?t=n(t,o.options):t+="<th>"+(o.columnName?o.columnName:o.fieldName)+"</th>":t+="<th>"+o+"</th>"}),t}function o(t,n,r){for(var a=0;a<r.length;++a){var i=r[a];if(n)if(i.type&&"object"===i.type)t=o(t,n[i.fieldName],i.options);else if(i.type&&"date"===i.type)if(n.hasOwnProperty(i.fieldName)){var f=n[i.fieldName];t+=f!==e&&null!==f?"<td>"+new Date(f).toLocaleString("de")+"</td>":"<td></td>"}else t+="<td></td>";else{var l=i.fieldName?i.fieldName:i;if(n.hasOwnProperty(l)){var f=n[l];t+=f!==e&&null!==f?"<td>"+f+"</td>":"<td></td>"}else t+="<td></td>"}else t+="<td></td>"}return t}function r(t,e,r){return r.length>0&&(t+="<tr>",t+=n(t,r),t+="</tr>",x.each(e,function(e,n){t+="<tr>",t=o(t,n,r),t+="</tr>"})),t}function a(t,e){e&&(t+=1462);var n=Date.parse(t);return(n-new Date(Date.UTC(1899,11,30)))/864e5}function i(t,e){for(var n={},o={s:{c:1e7,r:1e7},e:{c:0,r:0}},r=0;r!=t.length;++r)for(var i=0;i!=t[r].length;++i){o.s.r>r&&(o.s.r=r),o.s.c>i&&(o.s.c=i),o.e.r<r&&(o.e.r=r),o.e.c<i&&(o.e.c=i);var f={v:t[r][i]};if(null!=f.v){var l=XLSX.utils.encode_cell({c:i,r:r});"number"==typeof f.v?f.t="n":"boolean"==typeof f.v?f.t="b":f.v instanceof Date?(f.t="n",f.z=XLSX.SSF._table[14],f.v=a(f.v)):f.t="s",n[l]=f}}return o.s.c<1e7&&(n["!ref"]=XLSX.utils.encode_range(o)),n}function f(){return this instanceof f?(this.SheetNames=[],void(this.Sheets={})):new f}function l(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0;o!=t.length;++o)n[o]=255&t.charCodeAt(o);return e}function s(t,e,n,o){if(".xlsx"===o){var r=new f,a=i(t);r.SheetNames.push(n),r.Sheets[n]=a;var s={bookType:"xlsx",bookSST:!1,type:"binary"},p=XLSX.write(r,s);t=l(p)}saveAs(new Blob([t],{type:e+";"+x.fn.tableExport.charset}),n+o)}var x=t.jQuery;x.fn.convertJsonToHtml=function(t,e){var n=x.parseJSON(t),o='<table border="1">';return e?r(o,n,e):(x.each(n,function(t,e){o+="<tr>",x.each(e,function(t,e){o+="<td>"+t+"</td>",o+="<td>"+e+"</td>"}),o+="</tr>"}),o+="</table>")},x.fn.tableExport=function(t,e){var n,o,r,a=this,i=e?t:x.extend({},x.fn.tableExport.defaults,t),f=x.fn.tableExport.rowDel,l=i.ignoreRows instanceof Array?i.ignoreRows:[i.ignoreRows],p=i.ignoreCols instanceof Array?i.ignoreCols:[i.ignoreCols],d=i.ignoreCSS instanceof Array?i.ignoreCSS.join(", "):i.ignoreCSS;return i.bootstrap?(n=x.fn.tableExport.bootstrap[0]+" ",o=x.fn.tableExport.bootstrap[1]+" ",r=x.fn.tableExport.bootstrap[2]+" "):(n=x.fn.tableExport.defaultButton+" ",o=r=""),a.each(function(){function t(t){var e=JSON.parse(t),n=e.data,o=e.fileName,r=e.mimeType,a=e.fileExtension;s(n,r,o,a)}var n=x(this);e&&n.find("caption:not(.head)").remove();var o=n.find("tbody").find("tr"),o=i.headings?o.add(n.find("thead>tr")):o,o=i.footers?o.add(n.find("tfoot>tr")):o,r=i.headings?n.find("thead>tr").length:0,a="id"===i.fileName?n.attr("id")?n.attr("id"):x.fn.tableExport.defaultFileName:i.fileName,c={xlsx:function(e,n){var a=o.map(function(t,e){if(!~l.indexOf(t-r)&&!x(e).is(d)){var n=x(e).find("th, td");return[n.map(function(t,e){if(!~p.indexOf(t)&&!x(e).is(d))return x(e).text()}).get()]}}).get(),i=JSON.stringify({data:a,fileName:n,mimeType:x.fn.tableExport.xlsx.mimeType,fileExtension:x.fn.tableExport.xlsx.fileExtension});t(i)},xls:function(e,n){var a=x.fn.tableExport.xls.separator,i=o.map(function(t,e){if(!~l.indexOf(t-r)&&!x(e).is(d)){var n=x(e).find("th, td");return n.map(function(t,e){if(!~p.indexOf(t)&&!x(e).is(d))return x(e).text()}).get().join(a)}}).get().join(e),f=JSON.stringify({data:i,fileName:n,mimeType:x.fn.tableExport.xls.mimeType,fileExtension:x.fn.tableExport.xls.fileExtension});t(f)},csv:function(e,n){var a=x.fn.tableExport.csv.separator,i=o.map(function(t,e){if(!~l.indexOf(t-r)&&!x(e).is(d)){var n=x(e).find("th, td");return n.map(function(t,e){if(!~p.indexOf(t)&&!x(e).is(d))return x(e).text()}).get().join(a)}}).get().join(e),f=JSON.stringify({data:i,fileName:n,mimeType:x.fn.tableExport.csv.mimeType,fileExtension:x.fn.tableExport.csv.fileExtension});t(f)},txt:function(e,n){var a=x.fn.tableExport.txt.separator,i=o.map(function(t,e){if(!~l.indexOf(t-r)&&!x(e).is(d)){var n=x(e).find("th, td");return n.map(function(t,e){if(!~p.indexOf(t)&&!x(e).is(d))return x(e).text()}).get().join(a)}}).get().join(e),f=JSON.stringify({data:i,fileName:n,mimeType:x.fn.tableExport.txt.mimeType,fileExtension:x.fn.tableExport.txt.fileExtension});t(f)}};i.formats.forEach(function(t){c[t](f,a)})}),x.fn.tableExport.update=function(t){a.tableExport(x.extend({},i,t),!0)},x.fn.tableExport.reset=function(t){a.tableExport(i,!0)},x.fn.tableExport.remove=function(t){a.each(function(){x(this).find("caption:not(.head)").remove()})},a},x.fn.tableExport.defaults={headings:!0,footers:!0,formats:["xls","csv","txt"],fileName:"id",bootstrap:!0,position:"bottom",ignoreRows:null,ignoreCols:null,ignoreCSS:".tableexport-ignore"},x.fn.tableExport.charset="charset=utf-8",x.fn.tableExport.xlsx={defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},x.fn.tableExport.xls={defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},x.fn.tableExport.csv={defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"application/csv",fileExtension:".csv"},x.fn.tableExport.txt={defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},x.fn.tableExport.defaultFileName="myDownload",x.fn.tableExport.defaultButton="button-default",x.fn.tableExport.bootstrap=["btn","btn-default","btn-toolbar"],x.fn.tableExport.rowDel="\r\n",x.fn.tableExport.entityMap={"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47"}}(window);